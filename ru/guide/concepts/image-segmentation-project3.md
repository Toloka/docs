# Проект 3. Верно ли выделены объекты на изображении

{% include [deprecate](../../_includes/deprecate.md) %}

В этом [проекте](../../glossary.md#project) исполнители будут определять, верно ли на изображениях из [первого проекта](image-segmentation-project1.md) были выделены дорожные знаки во [втором проекте](image-segmentation-project2.md).

## Создайте проект {#create-project}

#### В интерфейсе:

1. Выберите шаблон:

    1. Нажмите кнопку **Создать проект**.
    1. Выберите шаблон **Распознавание объектов и выделение областей**.
    1. Нажмите **Использовать решение**.

1. Заполните общую информацию:

    1. В поле **Название для исполнителей** проекта введите `Верно ли выделены дорожные знаки`.
    1. В поле **Описание для исполнителей** введите `Посмотрите на изображение и решите, верно ли выделены дорожные знаки`.
    1. По желанию добавьте **Приватный комментарий**.

1. Отредактируйте интерфейс задания. От редактора интерфейса зависит формат выходных данных, поэтому выберите тот же редактор, что и в [Проекте 2](image-segmentation-project2.md#interface-tb-html).

    {% list tabs %}

    - Конструктор шаблонов

      1. Создайте шаблон на основе примера [Проверка выделенной области](https://ya.cc/t/Z9GC6HzT3ttEf6), в котором используется Компонент для разметки изображений.

      1. Чтобы увидеть поля входных и выходных данных, в разделе **Спецификация данных** нажмите **Показать спецификации**.

          Поля входных данных, которые используются в проекте:

          - `image` — адрес картинки;
          - `result` — массив с координатами выделенной области;
          - `assignment_id` — идентификатор задания.

          В поле выходных данных `verdict` будет записан ответ исполнителя.

      1. Включите опцию **Настроить спецификацию вручную**.

      1. Нажмите кнопку ![](../_images/other/code.svg), чтобы переключить графический режим на формат JSON.

      1. {% include [image-segmentation-project3-del-input-temp](../_includes/concepts/image-segmentation-project3/id-image-segmentation-project3/del-input-temp.md) %}

          ```json
          {
          "image": {
          "type": "url",
          "hidden": false,
          "required": true
          },
          "result": {
          "type": "array_json",
          "hidden": false,
          "required": false
          },
          "assignment_id": {
          "type": "string",
          "hidden": true,
          "required": true
          }
          }
          ```

      1. {% include [image-segmentation-project3-del-output-temp](../_includes/concepts/image-segmentation-project3/id-image-segmentation-project3/del-output-temp.md) %}

          ```json
          {
          "verdict": {
          "type": "string",
          "hidden": false,
          "required": true,
          "allowed_values": [
          "OK",
          "BAD"
          ]
          }
          }
          ```

    - Редактор HTML/CSS/JS

      1. Подготовьте **Интерфейс задания**:

      1. {% include [image-annotation-p_tgf_nsv_wlb](../_includes/concepts/t-components/image-annotation/id-image-annotation/p_tgf_nsv_wlb.md) %}

      1. В блоке **HTML** замените текущий код на следующий:

          ```html
          <!-- редактор для выделения областей с возможностью заранее добавить область -->
          {{field type="image-annotation" name="object" src=image annotations=selection}}

          <!-- кнопки для ответов -->
          {{field type="radio" name="result" value="OK" label="Верно" hotkey="1"}}
          {{field type="radio" name="result" value="BAD" label="Неверно" hotkey="2"}}
          ```

      1. В блоке **CSS** замените текущий код на следующий:

          ```css
          /* скрыть кнопку для выделения полигоном */
          .image-annotation-editor__shape-polygon {
          display: none;
          }

          /* настроить высоту интерфейса */
          .image-annotation-editor__annotation-layer {
          height: max-content;
          }
          ```

      1. Настройте раздел **Спецификация данных**:

      1. Нажмите кнопку ![](../_images/other/code.svg), чтобы переключить графический режим на формат JSON.

      1. Удалите шаблонный код из поля **Входные данные** и введите следующий код:

          ```json
          {
          "image": {
          "type": "url",
          "hidden": false,
          "required": true
          },
          "selection": {
          "type": "array_json",
          "hidden": false,
          "required": false
          },
          "assignment_id": {
          "type": "string",
          "hidden": true,
          "required": true
          }
          }
          ```

      1. Удалите шаблонный код из поля **Выходные данные** и введите следующий код:

          ```json
          {
          "result": {
          "type": "string",
          "hidden": false,
          "required": true,
          "allowed_values": [
          "OK",
          "BAD"
          ]
          }
          }
          ```

          Подробнее о параметрах **Спецификации** читайте в разделе [Входные и выходные данные](incoming.md).

      1. Нажмите кнопку ![](../_images/tutorials/image-segmentation/preview-button.svg) **Предпросмотр задания**, чтобы увидеть получившееся задание.

          {% note tip %}

          В предварительном просмотре проекта отображается одно задание со стандартными данными. Количество заданий на странице вы сможете настроить далее.

          {% endnote %}

      1. Нажмите **Изменить входные данные**.

      1. В поле **selection** добавьте пример входных данных:

          ```json
          [{"data":{"p1":{"x":0.472,"y":0.413},"p2":{"x":0.932,"y":0.877}},"type":"rectangle"},
          {"data":[{"x":0.143,"y":0.807},{"x":0.317,"y":0.87},{"x":0.511,"y":0.145},{"x":0.328,"y":0.096},{"x":0.096,"y":0.554}], "type":"polygon"}]
          ```

      1. Если все в порядке, закройте вкладку с предпросмотром. Если нет — проверьте данные, которые вы вставляли в блоки кода.

    {% endlist %}

1. Напишите инструкцию для исполнителей:

    **Текст инструкции:**

    ```plaintext
    Посмотрите на изображение и ответьте на вопрос: **Все ли дорожные знаки выделены верно?**
    Если да, нажмите **Да**.
    Если нет, нажмите **Нет**.
    Например, дорожные знаки выделены верно, поэтому правильный ответ **Да**.
    ```

    {% note tip %}

    Если вы хотите добавить в инструкцию примеры выполнения задания, выполните его самостоятельно в режиме предпросмотра. Сделайте скриншоты, загрузите их на фотохостинг, ваш Яндекс Диск или в облачное хранилище и вставьте ссылки на изображения в инструкцию, нажав кнопку ![](../_images/tutorials/image-segmentation/wsdm-tutorial-button.svg) на панели инструментов.

    {% endnote %}

1. Нажмите кнопку **Создать проект**.

## Создайте пул {#create_pool}

1. Откройте страницу проекта с именем **Верно ли выделены дорожные знаки?**.

1. Нажмите кнопку **Добавить пул**.

1. Укажите **Название пула**.

1. (опционально) Укажите **Приватный комментарий**. Эта информация доступна только вам.

1. В блоке **Аудитория** в разделе **Исполнители** отфильтруйте исполнителей:

    1. Нажмите **Добавить фильтр**.

    1. Добавьте фильтры **Регион по номеру телефона** и **Языки**: выберите исполнителей из России, Украины, Казахстана и Беларуси, которые в своем профиле отметили знание русского языка.

    1. Добавьте еще один фильтр. Нажмите **Добавить фильтр**.

    1. Найдите в списке блок **Навыки** и выберите навык **Выбрать свой навык**.

    1. В поле **Навыки** выберите **Выделение областей**.

    1. В поле **?** укажите `=`.

    1. Поле **Отсутствует** оставьте пустым.

    {% include [toloka-requester-source-filter-client-about](../_includes/toloka-requester-source/id-toloka-requester-source/filter-client-about.md) %}

1. {% include [contain_item-pool-speed-quality](../_includes/concepts/contain_item/id-contain_item/pool-speed-quality.md) %}

1. В блоке **Цена** в поле **Цена за страницу заданий** укажите цену. Например, `0.01`.

1. В блоке **Контроль качества** задайте [настройки контроля качества](control.md) для пула:

    1. Нажмите **Добавить правило контроля качества**.

    1. Найдите в списке блок **Правила** и выберите пункт **Мнение большинства**.

    1. В поле **Считать большинством** укажите `2`.

    1. Задайте правило: если **количество ответов** **≥ 10** и **процент правильных ответов** **< 50**, то **заблокировать** исполнителя **на проекте на 10 дней**. В качестве причины укажите **Не совпадает с большинством**.

    ![](../_images/tutorials/image-segmentation/majority-vote.png)

    {% note info %}

    Правило начинает действовать, когда количество ответов на задание равно [перекрытию](../../glossary.md#overlap).

    {% endnote %}

    Подробнее о контроле качества читайте в разделе [Контроль качества](control.md).

1. В разделе **Перекрытие задания** в поле **Количество исполнителей, которые должны выполнить каждое задание ** укажите `3`.

1. В блоке **Дополнительные настройки**:

    1. В поле **Время на страницу заданий** укажите `600`.

    1. Включите опцию **Сохранять порядок заданий**.

1. Нажмите кнопку **Создать пул**.

## Подготовьте и загрузите файл с результатами {#upload_file}

1. Подготовьте [файл](../../glossary.md#tsv) с заданиями:

    1. Откройте в редакторе текста или электронных таблиц файл, полученный после агрегации результатов во [втором проекте](image-segmentation-project2.md).

    1. Столбец `INPUT:image` оставьте без изменений.

    1. Измените имя столбца `OUTPUT:result` на `INPUT:selection`.

    1. Измените имя столбца `ASSIGNMENT:assignment_id` на `INPUT:assignment_id`.

    1. Удалите столбцы `ACCEPT:verdict` и `ACCEPT:comment`.

    1. Добавьте входные данные, например:

        ```json
        [{""type"":""rectangle"",""data"":{""p1"":{""x"":0.2421,""y"":0.98871},""p2"":{""x"":0.93663,""y"":0.8776}}}]
        ```

    и сохраните файл в формате `tsv`.

    {% note tip %}

    Вы можете подготовить файл в программе **Блокнот**. Чтобы перенести данные в **Microsoft Excel**, используйте **Мастер импорта текста**, отключив опцию **Ограничитель текста**.

    {% endnote %}

1. Загрузите получившийся файл в пул **Верно ли выделены дорожные знаки?** :

    1. Откройте пул **Верно ли выделены дорожные знаки?**

    1. Нажмите кнопку **Загрузить**. В открывшемся окне настройте параметры загрузки файла.

    1. Выберите **Указать вручную**.

    1. В поле **Заданий на странице** укажите `10`.

    1. Нажмите кнопку **Загрузить**.

    1. В открывшемся окне выберите файл с заданиями для загрузки и нажмите кнопку **Открыть**.

    1. В открывшемся окне проверьте количество заданий и нажмите кнопку **Добавить**.

    1. На странице пула нажмите кнопку **Предпросмотр**. Убедитесь, что в задании отображаются изображения с выделенными объектами.

    {% note tip %}

    Если выделенных объектов нет, проверьте, правильно ли выставлены кавычки в файле в столбце **INPUT:selection**. Убедитесь, что [параметры интерфейса](#task-interface) заданы верно.

    {% endnote %}

1. Нажмите кнопку ![](../_images/other/b-start-pool.svg), чтобы запустить пул.

    {% note alert %}

    Поставленные задачи выполнят настоящие исполнители Толоки. Перепроверьте конфигурацию вашего проекта перед запуском пула.

    {% endnote %}

## Скачайте проверенные результаты  {#get_results}

1. Рядом с кнопкой **Скачать результаты** нажмите кнопку ![Выпадающее меню](../_images/other/drop-down.svg).

1. Выберите из списка пункт **Агрегация результатов по методу Дэвида — Скина**. Подробнее об [Агрегации результатов по методу Дэвида — Скина](result-aggregation.md#dawid-skene).

1. В открывшемся окне нажмите **Да**.

1. Наверху страницы нажмите **Перейти к списку операций**.

    {% note info %}

    Отслеживайте прогресс операции, периодически обновляя страницу. Агрегация занимает от 5 до 20 минут, в это время вы можете приступить к оформлению другого проекта.

    {% endnote %}

1. Когда операция завершится, скачайте файл с результатами. Для этого в столбце **Файлы** нажмите **Скачать**.

1. Используйте файл с результатами во [втором проекте](image-segmentation-project2.md).

## Проверьте выполненные задания {#check_results}

Так как в настройках пула во [втором проекте](image-segmentation-project2.md) включена опция **Отложенная приёмка**, вы должны проверить ответы исполнителей в течение срока, установленного в поле **Срок проверки**.

Вы можете проверить результаты двумя способами:

- В файле с результатами.
- В интерфейсе пула.

{% list tabs %}

- Проверить задания в файле с результатами

  1. Откройте в редакторе текста или электронных таблиц файл, полученный после агрегации результатов.

      {% note tip %}

      Вы можете воспользоваться онлайн-редактором электронных таблиц. Перейдите на [Яндекс Диск]({{ yadisk-client }}), подключенный к вашему аккаунту заказчика. Нажмите **Создать → Таблицу**. Скопируйте в таблицу агрегированные данные из файла.

      {% endnote %}

  1. Подготовьте файл:

      1. Добавьте столбец `ACCEPT:verdict` — результат проверки.

      1. Добавьте столбец `ACCEPT:comment` — комментарий для исполнителя, если ответ был отклонен. Например, какая часть инструкций не была выполнена.

      1. Измените имя столбца `INPUT:assignment_id` на `ASSIGNMENT:assignment_id`.

  1. Заполните столбцы `ACCEPT:verdict:` и `ACCEPT:comment:`:

      - Если агрегированный результат задания правильный, поставьте `+`, и задание будет принято.
      - Если агрегированный результат задания неправильный или не открывается, поставьте `-`, и задание будет отклонено. Введите причину отклонения задания в поле `ACCEPT:comment:`, например, `Объект не выделен или выделен неверно.`

      {% note tip %}

      Для отбора изображений на устройствах с Linux и MacOS вы можете воспользоваться командами awk:

      ```shell
      awk 'BEGIN {FS=OFS="\t";} NR>1 {if($4~"OK"){ print $1, "+", ""; }else{ print $1, "-", "Объект не выделен или выделен неверно.";}}' <post_accept_res>.tsv > <review_res>.tsv
      ```

      {% endnote %}

  1. Удалите все остальные столбцы.

  1. Сохраните файл в формате `tsv`.

  1. Откройте страницу пула во [втором проекте](image-segmentation-project2.md).

  1. Нажмите кнопку **Проверить задания**.

  1. Нажмите кнопку **Загрузить результаты**.

  1. В открывшемся окне выберите файл с результатами для загрузки и нажмите кнопку **Открыть**.

  1. В открывшемся окне сравните количество заданий в поле **Успешно обработано** с полем **Всего выполненных заданий** на странице пула.

  1. Нажмите кнопку **Добавить**.

  1. В открывшемся окне нажмите кнопку **Закрыть**.

  1. При настройке пула во [втором проекте](image-segmentation-project2.md) вы включили опцию **Повторное выполнение отклонённых заданий**.

    При повторном выполнении задания пул автоматически открывается снова, и задания передаются другим исполнителям. Когда задания будут выполнены, отправьте результаты на проверку. Затем скачайте результаты, проверьте их и загрузите проверенные результаты. Вы можете отклонять задания столько раз, сколько захотите, чтобы получить более точные результаты.

- Проверить задания в интерфейсе пула

  1. Откройте страницу пула во [втором проекте](image-segmentation-project2.md).

  1. Нажмите кнопку **Просмотреть задания**.

  1. Наведите курсор на строку с заданием, которое хотите проверить.

  1. В столбце **Статус** появятся кнопки, чтобы принять (кнопка ![](../_images/tutorials/image-segmentation/wsdm-tutorial-button-yes.svg)) или отклонить (кнопка ![](../_images/tutorials/image-segmentation/wsdm-tutorial-button-no.svg)) выполненное задание. Если вы отклоняете задание, в открывшемся окне введите комментарий и нажмите кнопку **Готово**.

{% endlist %}

## Что дальше {#what-next}

- Почитайте подробнее [про декомпозицию заданий](solution-architecture.md).

{% include [contact-support](../_includes/contact-support.md) %}